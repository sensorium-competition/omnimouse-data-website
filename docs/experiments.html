<!-- experiments.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Experiment Details</title>
<link rel="icon" href="/assets/favicon.png" type="image/png"> <!-- adjust path -->
<style>
/* Material-like styles */
body { font-family: Roboto, sans-serif; margin: 2rem; background: #fff; color: #222; }
.md-typeset h1, .md-typeset h2 { margin-top: 1.5rem; }
.md-typeset p { margin: 0.5rem 0; }
.md-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
.md-table th, .md-table td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
.md-table th { background: #f2f2f2; }
.status { margin-top: 1rem; font-weight: bold; }
a { text-decoration: none; color: #1a73e8; }
a:hover { text-decoration: underline; }
</style>
</head>
<body>

<div class="md-typeset">
  <h1 id="exp-id">Experiment</h1>
  <p><strong>Date:</strong> <span id="exp-date"></span></p>
  <p><strong>Subject:</strong> <span id="exp-subject"></span></p>
  <p><strong>Status:</strong> <span id="exp-status"></span></p>

  <h2>Full Metadata</h2>
  <table class="md-table" id="exp-table">
    <thead><tr><th>Key</th><th>Value</th></tr></thead>
    <tbody></tbody>
  </table>

  <p class="status" id="status">Loading experiment data…</p>
  <p><a href="metadata_query/">Back to table</a></p>
</div>

<script>
(function() {
    function getQueryParam(name) {
        return new URLSearchParams(window.location.search).get(name);
    }

    const experimentId = getQueryParam('id');
    const statusEl = document.getElementById('status');

    if (!experimentId) {
        statusEl.textContent = "⚠️ No experiment ID provided in the URL.";
        return;
    }

    // Base path to JSON (adjust if necessary)
    const baseURL = window.location.origin + window.location.pathname.replace(/\/[^/]*$/, '');
    const jsonPath = `${baseURL}/experiment_metadata/combined_metadata.json`;

    fetch(jsonPath)
      .then(response => {
        if (!response.ok) throw new Error('Metadata file not found');
        return response.json();
      })
      .then(data => {
        const expData = data[experimentId];
        if (!expData) {
            statusEl.textContent = `⚠️ Experiment "${experimentId}" not found.`;
            return;
        }

        // Populate key fields
        document.getElementById('exp-id').textContent = experimentId;
        document.getElementById('exp-date').textContent = expData.date || "-";
        document.getElementById('exp-subject').textContent = expData.subject || "-";
        document.getElementById('exp-status').textContent = expData.status || "-";

        // Populate full metadata table
        const tbody = document.getElementById('exp-table').querySelector('tbody');
        tbody.innerHTML = "";
        for (const key in expData) {
            tbody.innerHTML += `<tr><td>${key}</td><td>${expData[key]}</td></tr>`;
        }

        statusEl.textContent = "Experiment data loaded.";
      })
      .catch(err => {
        statusEl.textContent = "⚠️ Error: Metadata file not found.";
        console.error(err);
      });
})();
</script>
<script>
// Use the user's system preference or manual class
const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

if (prefersDark) {
    document.documentElement.style.setProperty('--bg-color', '#121212');
    document.documentElement.style.setProperty('--text-color', '#ffffff');
    document.documentElement.style.setProperty('--link-color', '#8ab4f8');
    document.documentElement.style.setProperty('--table-header-bg', '#1e1e1e');
    document.documentElement.style.setProperty('--table-border', '#333');
}
</script>

<style>
:root {
    --bg-color: #ffffff;
    --text-color: #222222;
    --link-color: #1a73e8;
    --table-header-bg: #f2f2f2;
    --table-border: #ccc;
}

body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: Roboto, sans-serif;
    margin: 2rem;
}

a { color: var(--link-color); text-decoration: none; }
a:hover { text-decoration: underline; }

.md-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
.md-table th, .md-table td { border: 1px solid var(--table-border); padding: 0.5rem; text-align: left; }
.md-table th { background: var(--table-header-bg); }

.status { margin-top: 1rem; font-weight: bold; }
.md-typeset h1, .md-typeset h2 { margin-top: 1.5rem; }
</style>


</body>
</html>
